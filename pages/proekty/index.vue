<script setup lang="ts">
import { Search } from '@element-plus/icons-vue'
import type { ProjectCard } from '~/types/project.models'

// SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
const name = useSiteName()
useSeoMeta({
  title: `${name} ‚Äì –ü—Ä–æ–µ–∫—Ç—ã`,
  description: `${name} ‚Äî IT –∫–æ–º–ø–∞–Ω–∏—è –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–∞–π—Ç–æ–≤ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π`,
})
defineOgImageComponent('main', {
  title: `${name} ‚Äì –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ üìí`,
})
const projects: ProjectCard[] = [
  {
    id: 1,
    title: 'Lorem power',
    seo_url: 'lerempower',
    description:
      'Lorem Power ‚Äî —ç—Ç–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π —É—Å–ª—É–≥—É –∞—Ä–µ–Ω–¥—ã –ø–∞—É—ç—Ä–±–∞–Ω–∫–æ–≤ –≤ –ì–µ—Ä–º–∞–Ω–∏–∏. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—ã–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å, –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–∞—É—ç—Ä–±–∞–Ω–∫–∏.',
    services: [
      {
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
    ],
    logo: '/images/mock/projects/ampi/logo.svg',
  },
  {
    id: 2,
    title: '–õ–µ–ø–Ω–∏–Ω–∞',
    seo_url: 'lepnina',
    description:
      '–õ–µ–ø–Ω–∏–Ω–∞ ‚Äî —ç—Ç–æ –≤–µ–¥—É—â–∏–π –ø—Ä–æ–µ–∫—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ª–µ–ø–Ω–∏–Ω—ã. –ù–∞—à —Å–∞–π—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä —É—Å–ª—É–≥ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —É—Ç–æ–Ω—á–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä—å–µ—Ä —Å–≤–æ–∏—Ö –¥–æ–º–æ–≤, –æ—Ñ–∏—Å–æ–≤ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π.',
    services: [
      {
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
      {
        title: '–§–∏—Ä–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
    ],
    logo: '/images/mock/projects/phoenix/logo.svg',
  },
  {
    id: 3,
    title: 'Service',
    seo_url: 'service',
    description:
      'Service ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã, —Ä–∞–±–æ—Ç–∞—é—â–µ–µ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–¥–æ–±–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å, —á—Ç–æ–±—ã –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –ª—é–±–∏–º—ã–º–∏ –±–ª—é–¥–∞–º–∏ –∏–∑ –ª—É—á—à–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –¥–æ–º–∞.',
    services: [
      {
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
      {
        title: 'DevOps',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
    ],
    logo: '/images/mock/projects/premier/logo.svg',
  },
  {
    id: 4,
    title: 'Shop',
    seo_url: 'shop',
    description:
      'Shop ‚Äî —ç—Ç–æ –≤–µ–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤, –ª–∞–º–ø –∏ –º–µ–±–µ–ª–∏. –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —à–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å —É—é—Ç –∏ —Å—Ç–∏–ª—å –≤ –≤–∞—à–µ–º –¥–æ–º–µ –∏–ª–∏ –æ—Ñ–∏—Å–µ. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º –ø—Ä–æ–¥—É–∫—Ü–∏—é –æ—Ç –ª—É—á—à–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ü–µ–Ω–∞–º –∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É–¥–æ–±—Å—Ç–≤–æ–º.',
    services: [
      {
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞',
        tools: [
          {
            title: 'VS Code',
            description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
            image: '/images/mock/tools/vsc.png',
          },
          {
            title: 'Vitest',
            description: '–°—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–∞–∑–µ Vite.',
            image: '/images/mock/tools/vitest.png',
          },
          {
            title: 'Jest',
            description:
              '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JavaScript —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.',
            image: '/images/mock/tools/jest.png',
          },
        ],
      },
    ],
    logo: '/images/mock/projects/romatti/logo.svg',
  },
]

const search = ref('')
const selectedServices = ref<string[]>([])

const services = computed(() => {
  if (projects) {
    const uniqServiceTitle = Array.from(
      projects.reduce((set, element) => {
        element.services.forEach(service => {
          set.add(service.title)
        })
        return set
      }, new Set<string>())
    )
    return uniqServiceTitle
  } else return null
})
const filteredProjects = computed(() => {
  let filtered = projects

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º
  if (selectedServices.value.length > 0) {
    const selectedLabelsSet = new Set(selectedServices.value)
    filtered = filtered.filter(project =>
      project.services.some(project => selectedLabelsSet.has(project.title))
    )
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
  if (search.value) {
    const searchQuery = search.value.toLowerCase()
    filtered = filtered.filter(profession =>
      profession.title.toLowerCase().includes(searchQuery)
    )
  }
  return filtered
})
const debouncedFilteredProjects = refDebounced(filteredProjects, 700)
</script>

<template>
  <div>
    <nuxt-layout name="main">
      <ui-section class="project">
        <ui-h1>–ü—Ä–æ–µ–∫—Ç—ã</ui-h1>
        <div class="filters">
          <el-input
            v-model="search"
            class="filters__item"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏"
            clearable
          >
            <template #append>
              <el-button :icon="Search" />
            </template>
          </el-input>
          <el-select
            v-model="selectedServices"
            multiple
            collapse-tags
            collapse-tags-tooltip
            placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º"
            class="filters__item"
            clearable
          >
            <el-option
              v-for="item in services"
              :key="item"
              :label="item"
              :value="item"
            />
          </el-select>
        </div>
        <transition name="swipe" mode="out-in">
          <transition-group
            v-if="filteredProjects && filteredProjects.length > 0"
            name="list"
            tag="div"
            class="wrapper visability-hover"
          >
            <project-card
              v-for="project in debouncedFilteredProjects"
              :key="project.id"
              :project="project"
              tags-type="services"
            />
          </transition-group>
          <ui-empty v-else> –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω </ui-empty>
        </transition>
      </ui-section>
      <template #feedback>
        <app-request />
      </template>
    </nuxt-layout>
  </div>
</template>

<style scoped lang="scss">
.project {
  @apply container;
}
.wrapper {
  @apply relative grid grid-cols-1 gap-4;

  @media (min-width: theme('screens.lg')) {
    @apply grid-cols-2 gap-8;
  }
}
.filters {
  @apply mb-4 flex flex-col items-center gap-6 sm:flex-row;
  &__item {
    @apply w-full sm:w-[240px];
  }
}
</style>
